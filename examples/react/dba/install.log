Connected.
SQL> 
SQL> declare
  2  
  3  	 l_sql_text			   clob;
  4  	 l_default_tablespace		   database_properties.property_value%type;
  5  
  6  begin
  7  
  8  	 select  property_value
  9  	   into  l_default_tablespace
 10  	   from  database_properties
 11  	  where  property_name = 'DEFAULT_PERMANENT_TABLESPACE';
 12  
 13  	 l_sql_text := 'create user &5 identified by "&6"';
 14  	 execute immediate l_sql_text;
 15  
 16  	 l_sql_text := 'grant create session, create table, create procedure to &5';
 17  	 execute immediate l_sql_text;
 18  
 19  	 l_sql_text := 'alter user &5 quota 50M on '||l_default_tablespace;
 20  	 execute immediate l_sql_text;
 21  
 22  end;
 23  .
SQL> /

PL/SQL procedure successfully completed.

SQL> 
SQL> alter session set current_schema = &4;

Session altered.

SQL> 
SQL> insert into db_twig_services values ('asterionDBTutorials', '&5');

1 row created.

SQL> 
SQL> alter session set current_schema = &5;

Session altered.

SQL> 
SQL> create table insurance_claims
  2  (claim_id					     number(6) primary key,
  3   insured_party			     varchar2(60),
  4   accident_date			     date,
  5   deductible_amount 			 number(8,2),
  6   accident_location 		     varchar2(128),
  7   claims_adjuster_report		     varchar2(128));

Table created.

SQL> 
SQL> create table insurance_claim_photos
  2  (claim_id					 number(6)
  3  	references insurance_claims(claim_id),
  4   filename					 varchar2(128));

Table created.

SQL> 
SQL> create sequence tutorials_seq minvalue 1 maxvalue 999999 cycle start with 1;

Sequence created.

SQL> 
SQL> @@tutorials
SQL> create or replace package tutorials as
  2  
  3    function get_insurance_claim_detail
  4    (
  5  	 p_json_parameters		   clob
  6    )
  7    return clob;
  8  
  9    function get_insurance_claim_photos
 10    (
 11  	 p_claim_id			   insurance_claims.claim_id%type
 12    )
 13    return clob;
 14  
 15    function get_insurance_claims
 16    (
 17  	 p_json_parameters		   clob
 18    )
 19    return clob;
 20  
 21    procedure grant_execute_access
 22    (
 23  	 p_username			   user_users.username%type
 24    );
 25  
 26  end tutorials;
 27  .
SQL> /

Package created.

SQL> 
SQL> show errors package tutorials;
No errors.
SQL> @@tutorials.pls
SQL> create or replace package body tutorials as
  2  
  3    function get_insurance_claim_detail
  4    (
  5  	 p_json_parameters		   clob
  6    )
  7    return clob
  8  
  9    as
 10  
 11  	 l_json_object			   json_object_t := json_object_t(p_json_parameters);
 12  	 l_claim_id			   insurance_claims.claim_id%type;
 13  	 l_clob 			   clob;
 14  
 15    begin
 16  
 17  	 l_claim_id := l_json_object.get_number('claimId');
 18  
 19  	 select  json_object(
 20  		   'insuredParty' is insured_party,
 21  		   'accidentDate' is to_char(accident_date, 'dd-MON-yyyy'),
 22  		   'accidentLocation' is accident_location,
 23  		   'deductibleAmount' is deductible_amount,
 24  		   'claimsAdjusterReport' is claims_adjuster_report,
 25  		   'claimPhotos' is get_insurance_claim_photos(l_claim_id) format json
 26  		   returning clob)
 27  	   into  l_clob
 28  	   from  insurance_claims
 29  	  where  claim_id = l_claim_id;
 30  
 31  	 return l_clob;
 32  
 33    end get_insurance_claim_detail;
 34  
 35    function get_insurance_claim_photos
 36    (
 37  	 p_claim_id			   insurance_claims.claim_id%type
 38    )
 39    return clob
 40  
 41    as
 42  
 43  	 l_clob 			   clob;
 44  
 45    begin
 46  
 47  	 select  json_arrayagg(json_object(
 48  		   'mediaUrl' is filename)
 49  		   returning clob)
 50  	   into  l_clob
 51  	   from  insurance_claim_photos
 52  	  where  claim_id = p_claim_id;
 53  
 54  	 return l_clob;
 55  
 56    end get_insurance_claim_photos;
 57  
 58    function get_insurance_claims
 59    (
 60  	 p_json_parameters		   clob
 61    )
 62    return clob
 63  
 64    as
 65  
 66  	 l_clob 			   clob;
 67  
 68    begin
 69  
 70  	 select  json_arrayagg(json_object(
 71  		   'insuredParty' is insured_party,
 72  		   'claimId' is claim_id,
 73  		   'accidentDate' is to_char(accident_date, 'dd-MON-yyyy'))
 74  		   order by insured_party returning clob)
 75  	   into  l_clob
 76  	   from  insurance_claims;
 77  
 78  	 return l_clob;
 79  
 80    end get_insurance_claims;
 81  
 82    procedure grant_execute_access
 83    (
 84  	 p_username			   user_users.username%type
 85    )
 86  
 87    is
 88  
 89    begin
 90  
 91  	 execute immediate 'grant execute on tutorials to '||p_username;
 92  
 93    end grant_execute_access;
 94  
 95  end tutorials;
 96  .
SQL> /

Package body created.

SQL> 
SQL> show errors package body tutorials;
No errors.
SQL> 
SQL> spool off;
